---

- name: Install required packages
  become: yes
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - git

- name: Create fabio user
  include: user.yml
  when: fabio_create_user

- name: Create Fabio directories
  become: yes
  file:
    path: "{{ item }}"
    state: directory
  with_items:
    - "{{ fabio_directories_config }}"
    - "{{ fabio_directories_install }}"
    - "{{ fabio_directories_log }}"

- include: install_src.yml
  when: fabio_install_from_source

- include: install_binary.yml
  when: not fabio_install_from_source

- name: Install Fabio Upstart service
  become: yes
  template:
    dest: /etc/init/fabio.conf
    mode: 0755
    src: "{{ fabio_service_template }}"
  when: fabio_use_upstart

- name: Install Fabio systemd service
  become: yes
  template:
    dest: /etc/systemd/system/fabio.service
    mode: 0755
    src: fabio.systemd.j2
  when: fabio_use_systemd

- name: Enable Fabio service
  become: yes
  service:
    enabled: yes
    name: fabio
